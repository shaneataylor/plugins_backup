// WebAssign Help Header JavaScript

// This comment added 5/21 to ensure updated version deployed via git

function WA_init(){
    // show/hide frames buttons as needed
    if (parent.window.location.pathname == window.location.pathname ) {
        document.getElementById("WA_showtoc").className = "actionlink framesaction";
        document.getElementById("WA_hidetoc").className = "actionlink noframesaction framesCurrentState"; 
        //document.getElementById("WA_showtoc").setAttribute("style","display: inline;");
        //document.getElementById("WA_hidetoc").setAttribute("style","display: none;"); 
        var noframes = true;
    }
    else {
        document.getElementById("WA_showtoc").className = "actionlink framesaction framesCurrentState";
        document.getElementById("WA_hidetoc").className = "actionlink noframesaction"; 
        var noframes = false;
    }
    
    // set value of hidden current topic field
    var thistopic=location.pathname.split("/");
    thistopic=thistopic[thistopic.length-1];
    
    // initialize feedback drawer if it exists 
    if(document.getElementById("feedback_drawer")) {
        // initialize feedback as hidden
        WA_hidefeedback();
        document.getElementById("feedback_topic").setAttribute("value",thistopic);
        document.getElementById("feedback_status_instructor").setAttribute("checked","checked"); 
    }
}

function WA_footer() {
    // Write copyright statement to footer from topic metadata generated by the OT
    var footerContent = '';
    var months = new Array("January","February","March","April","May","June","July","August","September","October","November","December");
    var mod_Array = document.getElementsByName('DC.Date.Modified');
    // error capture for topics that do not get this set
    if (mod_Array.length > 0) {
        var mod_date = mod_Array[0].content.split("-");
        footerContent += "<p id=\"copyright\">&#xa9; " + mod_date[0] + " Advanced Instructional Systems, Inc. All rights reserved. (" + months[mod_date[1]-1] + " " + mod_date[0] + ")</p>";
    }
    else {
        footerContent +="<p id=\"copyright\">&#xa9; Advanced Instructional Systems, Inc. All rights reserved.</p>";
    }
    // add link to view contents if noframes view
    if (parent.window.location.pathname == window.location.pathname ) {
        footerContent +='<p><a href="toc.htm">View the table of contents and search the help system</a></p>';
    }
    document.getElementById("webassign_footer").innerHTML = footerContent;
}


function WA_helptop(){
    // open the help landing page with the TOC shown
    // get the URL of the help system
    var frameUrl = window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))  + "/index.html";
    // open the help system in the top window/frame
    var newWindow = window.open(frameUrl, '_top');
    newWindow.focus();
    return false;
}

function WA_showtoc(){
    // show the TOC without changing the current topic
    var frameUrl = window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))  + "/index.html";
    var thistopic=location.pathname.split("/");
    thistopic=thistopic[thistopic.length-1];
    var newWindow = window.open(frameUrl + '?q=' + thistopic, '_top');
    newWindow.focus();
    window.name = 'helpwin';
    return false;
}

function WA_hidetoc(){
    // noframes view
    var thistopic=location.pathname;
    var newWindow = window.open(thistopic, '_top');
    newWindow.focus();
    window.name = 'contentwin';
    return false;
}

function WA_printtopic(){
    // call browser's print function for current topic
    javascript:window.print()
}

// go to CS Help request form
// Note: Not passing current page or any fields already collected in the feedback form. 
//       This is because doing so with the current help page displays unfriendly warnings
//       about missing fields.
//       Fields we could pass include the help topic, fullname, email, status, other, and message.
//       But, we would not want to submit the form immediately after passing these values; rather,
//       use should be able to edit form first.
function WA_csform_student(){
    WA_hidefeedback();
    var thistopic=location.pathname.split("/");
    thistopic=thistopic[thistopic.length-1];
    var newWindow = window.open('http://webassign.force.com/wakb2/?cu=1&fs=ContactUs&l=en_US', '_blank');
    newWindow.focus();
}
function WA_csform_instructor(){
    WA_hidefeedback();
    var thistopic=location.pathname.split("/");
    thistopic=thistopic[thistopic.length-1];
    var newWindow = window.open('http://webassign.force.com/wakb2/?cu=1&fs=ContactUs&l=en_US', '_blank');
    newWindow.focus();
}

function WA_showfeedback(){
    // show the docs feedback div
    if(document.getElementById("feedback_drawer")) {
        document.getElementById("feedback_drawer").style.display = "block";
        changeElementsOfClass("table","nav","nav with_feedback");
    }
}

function WA_hidefeedback(){
    // hide the docs feedback div
    if(document.getElementById("feedback_drawer")) {
        document.getElementById("feedback_drawer").style.display = "none";
        changeElementsOfClass("table","nav","nav no_feedback");
    }
}

function WA_togglefeedback(){
    // If it's hidden, show it. If it's shown, hide it.
    if ( document.getElementById("feedback_drawer").style.display == "none" )
        { WA_showfeedback() }
    else
        { WA_hidefeedback() }
}

function WA_togglestatusdetail(statusflag) {
    if (statusflag == 'select_other' ) {
        document.getElementById("feedback_status_other").checked = true;
        document.getElementById("feedback_status_instructor").checked = false;
        document.getElementById("feedback_status_student").checked = false;
    }
    if ( document.getElementById("feedback_status_other").checked ) {
        document.getElementById("feedback_status_detail").removeAttribute("readonly");
        if (document.getElementById("feedback_status_detail").value == 'Other') {
            document.getElementById("feedback_status_detail").value = '';
        }
        document.getElementById("feedback_status_detail").focus();
    }
    else {
        document.getElementById("feedback_status_detail").setAttribute("readonly","readonly");
        if (document.getElementById("feedback_status_detail").value == '') {
            document.getElementById("feedback_status_detail").value = 'Other';
        }
    }
}

function WA_validatefeedback(){
    // validate the docs feedback form
    
    // init
    var errormessages = false;
    
    // test the email field
    var fieldvalue = document.getElementById("feedback_email").value;
    // trim all spaces, write trimmed value back to field
    fieldvalue = fieldvalue.replace(/\s/gi,"");
    document.getElementById("feedback_email").setAttribute("value",fieldvalue);
    // compare to regex and set error
    var pattern = /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}/i; 
    if ( !(pattern.test(fieldvalue)) ) {
        errormessages = true;
        document.getElementById("feedback_err_email").innerHTML="Enter a valid email address.";
    }
    else {
        document.getElementById("feedback_err_email").innerHTML=" ";
    }
    
    // test the status:other field
    var fieldvalue = document.getElementById("feedback_status_detail").value;
    // trim leading/trailing spaces, write trimmed value back to field
    fieldvalue = fieldvalue.replace(/^\s+/gi,"");
    fieldvalue = fieldvalue.replace(/\s+$/gi,"");
    document.getElementById("feedback_status_detail").setAttribute("value",fieldvalue);
    // compare to regex and set error
    var pattern = /^(?!Other$)\S+/i; 
    if ( ( document.getElementById("feedback_status_other").checked ) && !(pattern.test(fieldvalue)) ) {
        errormessages = true;
        document.getElementById("feedback_err_status_other").innerHTML="Specify a role for Other.";
    }
    else {
        document.getElementById("feedback_err_status_other").innerHTML=" ";
    }
    
    // enable submit if everything is valid
    if (! errormessages) {
        document.getElementById("feedback_submit").removeAttribute("disabled");
    }
    else {
        document.getElementById("feedback_submit").setAttribute("disabled","disabled");
    }
}

function WA_feedbackhelp(helpHTML){
    // show feedback helper text
    helpHTML = helpHTML.replace("||","</p><p>");
    document.getElementById("feedback_help").innerHTML="<p>" + helpHTML + "</p>";
}

function WA_feedbackclearhelp(){
    // show feedback helper text
    document.getElementById("feedback_help").innerHTML="";
}

function WA_submitfeedback(){
    // set values for hidden "feedback_status_text" and "feedback_rating_text" fields
   var ratingvalue = getCheckedValue(document.getElementsByName("feedback_rating"));
   document.getElementById("feedback_rating_text").setAttribute("value",ratingvalue);
    
   var statusvalue = getCheckedValue(document.getElementsByName("feedback_status"));
   if (statusvalue == 'Other') {
       statusvalue = document.getElementById("feedback_status_detail").value;
   }
   document.getElementById("feedback_status_text").setAttribute("value",statusvalue);

    
    WA_hidefeedback(); // close feedback div
    return true; // so normal form submission occurs
}

// Source: www.somacon.com/p143.php
// return the value of the radio button that is checked
// return an empty string if none are checked, or
// there are no radio buttons
function getCheckedValue(radioObj) {
	if(!radioObj)
		return "";
	var radioLength = radioObj.length;
	if(radioLength == undefined)
		if(radioObj.checked)
			return radioObj.value;
		else
			return "";
	for(var i = 0; i < radioLength; i++) {
		if(radioObj[i].checked) {
			return radioObj[i].value;
		}
	}
	return "";
}



function WA_expand_toc(docollapse){
    var classvalues = [
        ['hitarea expandable-hitarea','hitarea collapsable-hitarea'],
        ['hitarea expandable-hitarea lastExpandable-hitarea','hitarea collapsable-hitarea lastCollapsable-hitarea'],
        ['expandable','collapsable'],
        ['expandable lastExpandable','collapsable lastCollapsable']
    ];
    var stylevalues = [
        ['none','block']
    ];
    var idx0 = 0;
    var idx1 = 1;
    if (docollapse == "collapse") {
        var idx0 = 1;
        var idx1 = 0;
    }
    var treenodes = document.getElementById('tree').getElementsByTagName('*');
    for (var i = 0; i < treenodes.length; i++) {
        // change classes (li and div)
        var thisvalue = treenodes[i].getAttribute('class');
        for (var j = 0; j < classvalues.length; j++) {
            if (classvalues[j][idx0] == thisvalue) {
                treenodes[i].setAttribute('class',classvalues[j][idx1]);
                break; // don't check any more values for this node
            }
        }
        // change ul style
        var thisvalue = treenodes[i].style.display;
        for (var j = 0; j < stylevalues.length; j++) {
            if (stylevalues[j][idx0] == thisvalue) {
                treenodes[i].style.display = stylevalues[j][idx1];
                break; // don't check any more values for this node
            }
        }
    }
    return false;
}


function changeElementsOfClass(element_name,class_name,new_class) {
    var allTags = new Array();
    var allTags = document.getElementsByTagName(element_name);
    for (i=0; i<allTags.length; i++) {
        if (allTags[i].className.search(class_name)!=-1) {
            allTags[i].className = new_class;
        }
    }
}

/**
 * Hide and show div-s
 */
function hideDiv(hiddenDiv,showedDiv){   
    parent.termsToHighlight = Array();
    document.getElementById(hiddenDiv).style.display = "none";
    document.getElementById(showedDiv).style.display = "block";
    
	if (hiddenDiv == 'searchDiv'){
		document.getElementById('divContent').innerHTML = '<font class="normalLink">Contents</font>';
		document.getElementById('divSearch').innerHTML = '<a href="javascript:void(0);" class="activeLink" id="searchLink" onclick="hideDiv(\'displayContentDiv\',\'searchDiv\')">Search Results</a>';
	} else {
		document.getElementById('divContent').innerHTML = '<a href="javascript:void(0);" class="activeLink" id="contentLink" onclick="hideDiv(\'searchDiv\',\'displayContentDiv\')">Contents</a>';
		document.getElementById('divSearch').innerHTML = '<font class="normalLink">Search Results</font>';
	}
    
    $('*', window.parent.frames[1].document).unhighlight();
}


